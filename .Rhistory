# 1. Install and Load Required Packages
install.packages("nnet")
install.packages("dplyr")
install.packages("cobalt")
library(nnet)
library(dplyr)
library(cobalt)
# 2. Load Your Data
url <- "https://raw.githubusercontent.com/jeevanbhatta/causal_inference/refs/heads/main/data/processed/GlobalProtestTracker_with_outcomes.csv"
data <- read.csv(url)
# 3. Create Binary Treatment: Long Protest (≥ 30 days)
data <- data %>%
mutate(long_protest = ifelse(Duration_days >= 30, 1, 0))
# 4. Estimate Propensity Score for Long Protest using Covariates
ps_model <- glm(long_protest ~ Peak_Size + Key_Participants_category + Motivations_category + Triggers_category,
data = data, family = binomial)
data$pscore <- predict(ps_model, type = "response")
/Users/jeevanbhatta/Downloads/causal_inference/classes/session12.r
# 1. Install and Load Required Packages
install.packages("nnet")
install.packages("dplyr")
# 1. Install and Load Required Packages
#install.packages("nnet")
#install.packages("dplyr")
#install.packages("cobalt")
library(nnet)
library(dplyr)
library(cobalt)
# 2. Load Data
url <- "https://raw.githubusercontent.com/jeevanbhatta/causal_inference/refs/heads/main/data/processed/GlobalProtestTracker_with_outcomes.csv"
data <- read.csv(url)
# 3. Create Binary Treatment Variable: Long Protest (≥ 30 days)
data <- data %>%
mutate(long_protest = ifelse(Duration_days >= 30, 1, 0))
# 4. Remove Cases with Missing Values in Any Model Covariates
covariates <- c("Peak_Size", "Key_Participants_category", "Motivations_category", "Triggers_category", "long_protest")
data_complete <- data %>%
filter(complete.cases(select(., all_of(covariates))))
# 5. Estimate Propensity Score
ps_model <- glm(long_protest ~ Peak_Size + Key_Participants_category + Motivations_category + Triggers_category,
data = data_complete, family = binomial)
data_complete$pscore <- predict(ps_model, type = "response")
# 6. Calculate IPW (Inverse Probability Weights)
data_complete <- data_complete %>%
mutate(ipw = ifelse(long_protest == 1, 1/pscore, 1/(1-pscore)))
# 7. Weighted Multinomial Regression
model_ipw <- multinom(outcome_label ~ long_protest + Peak_Size + Key_Participants_category +
Motivations_category + Triggers_category,
data = data_complete, weights = ipw)
summary(model_ipw)
# 8. Covariate Balance Table
bal.tab(long_protest ~ Peak_Size + Key_Participants_category + Motivations_category + Triggers_category,
data = data_complete, weights = data_complete$ipw, un = TRUE)
# 9. Love Plot to Visualize Covariate Balance
love.plot(long_protest ~ Peak_Size + Key_Participants_category + Motivations_category + Triggers_category,
data = data_complete, weights = data_complete$ipw,
threshold = 0.1,
abs = TRUE,
var.order = "unadjusted")
# 1. Install and Load Required Packages
#install.packages("nnet")
#install.packages("dplyr")
#install.packages("cobalt")
library(nnet)
library(dplyr)
library(cobalt)
# 2. Load Data
url <- "https://raw.githubusercontent.com/jeevanbhatta/causal_inference/refs/heads/main/data/processed/GlobalProtestTracker_with_outcomes.csv"
data <- read.csv(url)
# 3. Create Binary Treatment Variable: Long Protest (≥ 30 days)
data <- data %>%
mutate(long_protest = ifelse(Duration_days >= 30, 1, 0))
summary(model1)
# 1. Install and Load Required Packages
#install.packages("nnet")
#install.packages("dplyr")
#install.packages("cobalt")
library(nnet)
library(dplyr)
library(cobalt)
# 2. Load Data
url <- "https://raw.githubusercontent.com/jeevanbhatta/causal_inference/refs/heads/main/data/processed/GlobalProtestTracker_with_outcomes.csv"
data <- read.csv(url)
# 2.1 simple Multinomial regression
model1 <- multinom(outcome_label ~ Duration_days+Peak_Size+Key_Participants_category+Motivations_category+Triggers_category, data = data)
summary(model1)
# 3. Create Binary Treatment Variable: Long Protest (≥ 30 days)
data <- data %>%
mutate(long_protest = ifelse(Duration_days >= 30, 1, 0))
# 4. Remove Cases with Missing Values in Any Model Covariates
covariates <- c("Peak_Size", "Key_Participants_category", "Motivations_category", "Triggers_category", "long_protest")
data_complete <- data %>%
filter(complete.cases(select(., all_of(covariates))))
# 5. Estimate Propensity Score
ps_model <- glm(long_protest ~ Peak_Size + Key_Participants_category + Motivations_category + Triggers_category,
data = data_complete, family = binomial)
data_complete$pscore <- predict(ps_model, type = "response")
# 6. Calculate IPW (Inverse Probability Weights)
data_complete <- data_complete %>%
mutate(ipw = ifelse(long_protest == 1, 1/pscore, 1/(1-pscore)))
# 7. Weighted Multinomial Regression
model_ipw <- multinom(outcome_label ~ long_protest + Peak_Size + Key_Participants_category +
Motivations_category + Triggers_category,
data = data_complete, weights = ipw)
summary(model_ipw)
# loading the data
cash_voting <- read.csv("https://bit.ly/cash_voting")
head(cash_voting)
bal.plot(matched_outcome_ps, "hdi_2000", which = "both")
# MatchIt is already loaded
# code for propensity-score matching
# change parameters to achieve the best outcome
matched_outcome_ps = matchit(beneficiary ~ female + age + yrs_school + hdi_2000, data = cash_voting, method = NULL, distance = "glm")
install.packages("MatchIt")
library(MatchIt)
install.packages("rgenoud")
library(rgenoud)
install.packages("cobalt")
library(cobalt)
# loading the data
cash_voting <- read.csv("https://bit.ly/cash_voting")
install.packages("cobalt")
head(cash_voting)
# MatchIt is already loaded
# code for propensity-score matching
# change parameters to achieve the best outcome
matched_outcome_ps = matchit(beneficiary ~ female + age + yrs_school + hdi_2000, data = cash_voting, method = NULL, distance = "glm")
love.plot(matched_outcome_ps)
bal.plot(matched_outcome_ps, "female", which = "both")
bal.plot(matched_outcome_ps, "age", which = "both")
bal.plot(matched_outcome_ps, "yrs_school", which = "both")
bal.plot(matched_outcome_ps, "hdi_2000", which = "both")
# MatchIt is already loaded
# code for propensity-score matching
# change parameters to achieve the best outcome
matched_outcome_ps = matchit(beneficiary ~ female + age + yrs_school + hdi_2000, data = cash_voting, caliper = 0.2, ratio=1)
love.plot(matched_outcome_ps)
bal.plot(matched_outcome_ps, "female", which = "both")
bal.plot(matched_outcome_ps, "age", which = "both")
bal.plot(matched_outcome_ps, "yrs_school", which = "both")
# MatchIt is already loaded
# code for propensity-score matching
# change parameters to achieve the best outcome
matched_outcome_ps = matchit(beneficiary ~ female + age + yrs_school + hdi_2000, data = cash_voting, caliper = 0.4, ratio=1)
love.plot(matched_outcome_ps)
bal.plot(matched_outcome_ps, "female", which = "both")
bal.plot(matched_outcome_ps, "age", which = "both")
bal.plot(matched_outcome_ps, "age", which = "both")
bal.plot(matched_outcome_ps, "yrs_school", which = "both")
# code for Mahalanobis distance matching
# change parameters to achieve the best outcome
matched_outcome_mahalanobis = matchit(beneficiary ~ female + age + yrs_school + hdi_2000, data = cash_voting, method="nearest", distance="glm")
love.plot(matched_outcome_mahalanobis)
bal.plot(matched_outcome_mahalanobis, "female", which = "both")
bal.plot(matched_outcome_mahalanobis, "age", which = "both")
bal.plot(matched_outcome_mahalanobis, "yrs_school", which = "both")
# code for Mahalanobis distance matching
# change parameters to achieve the best outcome
matched_outcome_mahalanobis = matchit(beneficiary ~ female + age + yrs_school + hdi_2000, data = cash_voting, method="full", distance="glm")
# code for Mahalanobis distance matching
# change parameters to achieve the best outcome
matched_outcome_mahalanobis = matchit(beneficiary ~ female + age + yrs_school + hdi_2000, data = cash_voting, method="full", distance="mahalanobis")
# code for Mahalanobis distance matching
# change parameters to achieve the best outcome
matched_outcome_mahalanobis = matchit(beneficiary ~ female + age + yrs_school + hdi_2000, data = cash_voting, method="full", distance="mahalanobis")
love.plot(matched_outcome_mahalanobis)
bal.plot(matched_outcome_mahalanobis, "female", which = "both")
bal.plot(matched_outcome_mahalanobis, "age", which = "both")
bal.plot(matched_outcome_mahalanobis, "yrs_school", which = "both")
# code for genetic matching
# change parameters to achieve the best outcome
matched_outcome_genetic = matchit(beneficiary ~ female + age + yrs_school + hdi_2000, data = cash_voting, method="genetic", pop.size = 100,max.generations = 50))
# code for genetic matching
# change parameters to achieve the best outcome
matched_outcome_genetic = matchit(beneficiary ~ female + age + yrs_school + hdi_2000, data = cash_voting, method="genetic",pop.size=100, max.generations=50)
# code for genetic matching
# change parameters to achieve the best outcome
matched_outcome_genetic = matchit(beneficiary ~ female + age + yrs_school + hdi_2000, data = cash_voting, method="genetic",pop.size=100, max.generations=50)
love.plot(matched_outcome_genetic)
bal.plot(matched_outcome_genetic, "female", which = "both")
bal.plot(matched_outcome_genetic, "age", which = "both")
bal.plot(matched_outcome_genetic, "yrs_school", which = "both")
bal.plot(matched_outcome_genetic, "hdi_2000", which = "both")
# code for genetic matching
# change parameters to achieve the best outcome
matched_outcome_genetic = matchit(beneficiary ~ female + age + yrs_school + hdi_2000, data = cash_voting, method="genetic",pop.size=100, max.generations=50)
love.plot(matched_outcome_genetic)
bal.plot(matched_outcome_genetic, "female", which = "both")
bal.plot(matched_outcome_genetic, "age", which = "both")
bal.plot(matched_outcome_genetic, "yrs_school", which = "both")
bal.plot(matched_outcome_genetic, "hdi_2000", which = "both")
bal.plot(matched_outcome_mahalanobis, "hdi_2000", which = "both")
# code for Mahalanobis distance matching
# change parameters to achieve the best outcome
matched_outcome_mahalanobis = matchit(beneficiary ~ female + age + yrs_school + hdi_2000, data = cash_voting, method="full", distance="mahalanobis")
love.plot(matched_outcome_mahalanobis)
bal.plot(matched_outcome_mahalanobis, "female", which = "both")
bal.plot(matched_outcome_mahalanobis, "age", which = "both")
bal.plot(matched_outcome_mahalanobis, "yrs_school", which = "both")
bal.plot(matched_outcome_mahalanobis, "hdi_2000", which = "both")
bal.plot(matched_outcome_genetic, "age", which = "both")
bal.plot(matched_outcome_genetic, "yrs_school", which = "both")
bal.plot(matched_outcome_genetic, "hdi_2000", which = "both")
love.plot(matched_outcome_mahalanobis)
love.plot(matched_outcome_ps)
love.plot(matched_outcome_genetic)
bal.plot(matched_outcome_genetic, "female", which = "both")
dplyr::glimpse(guns)
guns = read.csv("https://raw.githubusercontent.com/ahdvnd/ss154-data/main/guns.csv")
dplyr::glimpse(guns)
pooled = lm(log(vio) ~ shall + incarc_rate + density + avginc + pop + pb1064 + pw1064 + pm1029,, data = guns)
summary(pooled)
# add state fixed effects via LSDV
lsdv <- lm(
log(vio) ~ shall + incarc_rate + density + avginc + pop +
pb1064 + pm1029 + factor(stateid),
data = guns
)
summary(lsdv)$coefficients["shall", ]
guns = read.csv("https://raw.githubusercontent.com/ahdvnd/ss154-data/main/guns.csv")
dplyr::glimpse(guns)
pooled = lm(log(vio) ~ shall + incarc_rate + density + avginc + pop + pb1064 + pw1064 + pm1029,, data = guns)
summary(pooled)
# add state fixed effects via LSDV
lsdv <- lm(
log(vio) ~ shall + incarc_rate + density + avginc + pop +
pb1064 + pm1029 + factor(stateid),
data = guns
)
summary(lsdv)$coefficients["shall", ]
library(plm)
!install(plm)
library(plm)
install.packages("plm")
library(plm)
# declare panel structure
guns_panel <- pdata.frame(guns, index = c("stateid", "year"))
# two-way fixed effects (state and time) within estimator
twfe <- plm(
log(vio) ~ shall + incarc_rate + density + avginc + pop +
pb1064 + pw1064 + pm1029,
data   = guns_panel,
model  = "within",
effect = "twoways"
)
summary(twfe)$coefficients["shall", ]
View(guns)
View(guns)
summary(twfe)$coefficients["shall", ]
load("~/Minerva/SS154/AI_Effects_On_Labour_Market/analysis/did_analysis_complete.R")
# Clear environment
rm(list = ls())
packages <- c("tidyverse", "fixest", "modelsummary", "kableExtra")
install_if_missing <- function(pkg) {
if (!require(pkg, character.only = TRUE)) {
install.packages(pkg, dependencies = TRUE)
library(pkg, character.only = TRUE)
}
}
lapply(packages, install_if_missing)
# Set working directory to project root
project_root <- "/Users/jeevanbhatta/Minerva/SS154/AI_Effects_On_Labour_Market"
setwd(project_root)
# Create output directories
dir.create("paper/figures", showWarnings = FALSE, recursive = TRUE)
dir.create("paper/tables", showWarnings = FALSE, recursive = TRUE)
# Set ggplot theme
theme_set(theme_minimal(base_size = 12))
# Load the complete occupation panel (only rows with complete data)
df <- read.csv("data/occupation_panel_complete.csv")
cat("="*80, "\n")
# Create analysis variables
df <- df %>%
mutate(
# Factor variables for fixed effects
Industry_factor = factor(Industry),
State_factor = factor(State),
Year_factor = factor(Year),
Occupation_factor = factor(Occupation),
# Treatment: High AI exposure (top 33%) × Post period (2023+)
AI_threshold = quantile(AI_Exposure_Score, 0.67, na.rm=TRUE),
HighAIExposure = as.integer(AI_Exposure_Score >= AI_threshold),
Treat = HighAIExposure * Post,
# Event study: Years relative to 2023
EventTime = Year - 2023,
EventTime_factor = factor(EventTime)
)
# Summary of treatment groups
cat("Treatment Group Definition:\n")
cat(sprintf("  AI Exposure threshold (67th percentile): %.3f\n",
unique(df$AI_threshold)))
cat(sprintf("  High exposure observations: %d (%.1f%%)\n",
sum(df$HighAIExposure), mean(df$HighAIExposure)*100))
cat(sprintf("  Low exposure observations: %d (%.1f%%)\n\n",
sum(1-df$HighAIExposure), mean(1-df$HighAIExposure)*100))
cat("="*80, "\n")
cat("SUMMARY STATISTICS\n")
cat("SUMMARY STATISTICS\n")
